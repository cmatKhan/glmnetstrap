% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_cv_glmnet.R
\name{fit_cv_glmnet}
\alias{fit_cv_glmnet}
\title{Fit a Cross-Validated glmnet Model with Optional Bootstrap Weights and
Variable Subsetting}
\usage{
fit_cv_glmnet(
  x,
  y,
  fold_classes = NULL,
  active_predictors = NULL,
  seed = NULL,
  ...
)
}
\arguments{
\item{x}{A numeric matrix of predictors (samples x features). Must have
column names.}

\item{y}{A numeric response vector of length equal to the number of rows
in \code{x}.}

\item{fold_classes}{Optional vector of class labels (same length as \code{y})
used to stratify the cross-validation folds. \strong{NOTE}
see \code{\link[caret]{createFolds}} with regards to how numeric vs
factor levels are handled. If \code{NULL}, glmnet will handle CV splitting.
If this is provided, \code{nfolds} must also be passed}

\item{active_predictors}{Optional logical or numeric index vector indicating
which predictors to include in the model. If \code{NULL}, all predictors are
used. If logical, must be the same length as \code{ncol(x)}. This argument
is intended to be used in an interative process to drop out predictors}

\item{seed}{Integer seed for reproducible fold creation.}

\item{...}{
  Arguments passed on to \code{\link[glmnet:cv.glmnet]{glmnet::cv.glmnet}}
  \describe{
    \item{\code{weights}}{Observation weights; defaults to 1 per observation}
    \item{\code{offset}}{Offset vector (matrix) as in \code{glmnet}}
    \item{\code{lambda}}{Optional user-supplied lambda sequence; default is
\code{NULL}, and \code{glmnet} chooses its own sequence. Note that this is done
for the full model (master sequence), and separately for each fold.
The fits are then alligned using the master sequence (see the \code{allignment}
argument for additional details). Adapting \code{lambda} for each fold
leads to better convergence. When \code{lambda} is supplied, the same sequence
is used everywhere, but in some GLMs can lead to convergence issues.}
    \item{\code{type.measure}}{loss to use for cross-validation. Currently five
options, not all available for all models. The default is
\code{type.measure="deviance"}, which uses squared-error for gaussian models
(a.k.a \code{type.measure="mse"} there), deviance for logistic and poisson
regression, and partial-likelihood for the Cox model.
\code{type.measure="class"} applies to binomial and multinomial logistic
regression only, and gives misclassification error.
\code{type.measure="auc"} is for two-class logistic regression only, and
gives area under the ROC curve. \code{type.measure="mse"} or
\code{type.measure="mae"} (mean absolute error) can be used by all models
except the \code{"cox"}; they measure the deviation from the fitted mean to
the response. For binomial model and binary data, \code{type.measure="mse"} amounts to the "Brier" score.
\code{type.measure="C"} is Harrel's concordance measure, only available for \code{cox} models.}
    \item{\code{nfolds}}{number of folds - default is 10. Although \code{nfolds} can be
as large as the sample size (leave-one-out CV), it is not recommended for
large datasets. Smallest value allowable is \code{nfolds=3}}
    \item{\code{foldid}}{an optional vector of values between 1 and \code{nfolds}
identifying what fold each observation is in. If supplied, \code{nfolds} can
be missing.}
    \item{\code{alignment}}{This is an experimental argument, designed to fix the
problems users were having with CV, with possible values \code{"lambda"}
(the default) else \code{"fraction"}. With \code{"lambda"} the \code{lambda}
values from the master fit (on all the data) are used to line up the
predictions from each of the folds. In some cases this can give strange
values, since the effective \code{lambda} values in each fold could be quite
different. With \code{"fraction"} we line up the predictions in each fold
according to the fraction of progress along the regularization. If in the
call a \code{lambda} argument is also provided, \code{alignment="fraction"}
is ignored (with a warning).}
    \item{\code{grouped}}{This is an experimental argument, with default \code{TRUE},
and can be ignored by most users. For all models except the \code{"cox"},
this refers to computing \code{nfolds} separate statistics, and then using
their mean and estimated standard error to describe the CV curve. If
\code{grouped=FALSE}, an error matrix is built up at the observation level
from the predictions from the \code{nfolds} fits, and then summarized (does
not apply to \code{type.measure="auc"}). For the \code{"cox"} family,
\code{grouped=TRUE} obtains the CV partial likelihood for the Kth fold by
\emph{subtraction}; by subtracting the log partial likelihood evaluated on
the full dataset from that evaluated on the on the (K-1)/K dataset. This
makes more efficient use of risk sets. With \code{grouped=FALSE} the log
partial likelihood is computed only on the Kth fold}
    \item{\code{keep}}{If \code{keep=TRUE}, a \emph{prevalidated} array is returned
containing fitted values for each observation and each value of
\code{lambda}. This means these fits are computed with this observation and
the rest of its fold omitted. The \code{foldid} vector is also returned.
Default is keep=FALSE.  If \code{relax=TRUE}, then a list of such arrays is
returned, one for each value of 'gamma'. Note: if the value 'gamma=1' is
omitted, this case is included in the list since it corresponds to the
original 'glmnet' fit.}
    \item{\code{parallel}}{If \code{TRUE}, use parallel \code{foreach} to fit each
fold.  Must register parallel before hand, such as \code{doMC} or others.
See the example below.}
    \item{\code{gamma}}{The values of the parameter for mixing the relaxed fit with the
regularized fit, between 0 and 1; default is \code{gamma = c(0, 0.25, 0.5,
0.75, 1)}}
    \item{\code{relax}}{If \code{TRUE}, then CV is done with respect to the mixing
parameter \code{gamma} as well as \code{lambda}. Default is
\code{relax=FALSE}}
    \item{\code{trace.it}}{If \code{trace.it=1}, then progress bars are displayed;
useful for big models that take a long time to fit. Limited tracing if
\code{parallel=TRUE}}
  }}
}
\value{
A fitted \code{cv.glmnet} object.
}
\description{
This function fits a penalized regression model using \code{cv.glmnet} with
support for: bootstrap-derived observation weights, stratified
cross-validation folds, and an active set of coefficients. It also
allows the user to override default settings such as \code{penalty.factor}
and \code{weights} via \code{...}.
}
\examples{
\dontrun{
x <- matrix(rnorm(100 * 10), nrow = 100, ncol = 10)
y <- rnorm(100)
classes <- sample(c("A", "B"), 100, replace = TRUE)
fit <- cv_glmnet_stratified_active(x, y, fold_classes = classes, alpha = 1)
}

}
